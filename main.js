!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);o.textContent="",t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass)},r=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);(e=>e.some(e=>!e.validity.valid))(r)?o(n,t):(n.disabled=!1,n.classList.remove(t.inactiveButtonClass))},o=t=>{t.disabled=!0,t.classList.add(e.inactiveButtonClass)},n=(e,r,o)=>{r.forEach(r=>{t(e,r,o)})};const a=document.querySelector(".profile__edit-btn"),s=document.querySelector("#edit-profile-modal"),c=s.querySelector(".modal__close-btn"),l=s.querySelector(".modal__form"),i=s.querySelector("#profile-name-input"),d=s.querySelector("#profile-description-input"),u=document.querySelector(".profile__add-btn"),m=document.querySelector("#new-post-modal"),_=m.querySelector(".modal__close-btn"),f=document.querySelector(".profile__avatar-btn"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),p=m.querySelector(".modal__form"),h=m.querySelector(".modal__submit-btn"),S=p.querySelector("#card-caption-input"),q=p.querySelector("#card-image-input"),b=document.querySelector("#preview-modal"),E=b.querySelector(".modal__close-btn"),L=b.querySelector(".modal__image"),C=b.querySelector(".modal__caption"),k=document.querySelector("#delete-modal"),g=k.querySelector(".modal__close-button"),U=document.querySelector("#avatar-modal"),$=U.querySelector(".modal__form"),A=(U.querySelector(".modal__button"),U.querySelector(".modal__close"),U.querySelector("#profile-avatar-input")),j=document.querySelector("#card-template").content.querySelector(".card"),x=document.querySelector(".cards__list"),I=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return this.getUserInfo(),Promise.all([this.getUserInfo(),this.getInitialCards()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)})}updateAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"5ede9bfe-962f-4ec5-91f2-d91f0ad8bf92","Content-Type":"application/json"}});function P(e){const t=j.cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return o.src=e.link,o.alt=e.name,r.textContent=e.name,n.addEventListener("click",()=>{n.classList.toggle("card__like-btn_active")}),a.addEventListener("click",r=>{handleDeleteCard(t,e),w(k),t.remove()}),o.addEventListener("click",()=>{L.src=e.link,L.alt=e.name,C.textContent=e.name,w(b)}),E.addEventListener("click",()=>{B(b)}),t}function w(e){e.classList.add("modal__is-opened"),document.addEventListener("keydown",T),e.addEventListener("mousedown",D)}function B(e){e.classList.remove("modal__is-opened"),document.removeEventListener("keydown",T),e.removeEventListener("mousedown",D)}function T(e){if("Escape"===e.key){const e=document.querySelector(".modal__is-opened");e&&B(e)}}function D(e){e.target.classList.contains("modal__is-opened")&&B(e.currentTarget)}I.getAppInfo().then(([e,t])=>(t.forEach(e=>{const t=P(e);x.prepend(t)}),e)).then(e=>{document.querySelector(".profile__avatar").src=e.avatar,v.textContent=e.name,y.textContent=e.about}).catch(console.error),f.addEventListener("click",()=>{w(U)}),$.addEventListener("submit",function(e){e.preventDefault();const t=A.value;I.updateAvatar({avatar:t}).then(e=>{document.querySelector(".profile__avatar").src=e.avatar,B(U),$.reset(),console.log(e.avatar)}).catch(console.error)}),a.addEventListener("click",function(){i.value=v.textContent,d.value=y.textContent,n(l,[i,d],e),r(l,e),w(s)}),u.addEventListener("click",function(){w(m)}),c.addEventListener("click",function(){B(s)}),_.addEventListener("click",function(){B(m)}),l.addEventListener("submit",function(e){e.preventDefault(),I.editUserInfo({name:i.value,about:d.value}).then(e=>{v.textContent=e.name,y.textContent=e.about,B(s),console.log("submitting")}).catch(console.error)}),p.addEventListener("submit",function(t){t.preventDefault(),o(h,e);const r=P({name:S.value,link:q.value});x.prepend(r),p.reset(),n(p,[S,q],e),B(m)}),g.addEventListener("click",()=>{B(k)}),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector));e.querySelector(o.submitButtonSelector),r(e,o),n.forEach(n=>{n.addEventListener("input",function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);n.textContent=r,t.classList.add(o.inputErrorClass),n.classList.add(o.errorClass)})(e,r,r.validationMessage,o)})(e,n,o),r(e,o)})})})(o,e)})})(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxJQXdDekRtSSxDQUFtQjNILEVBQVEwSCxFQUFjbEksR0FDekNnQixFQUFrQlIsRUFBUVIsRUFDNUIsTUFPQWlJLENBQWtCekgsRUFBUVIsTUNvTDlCdUksQ0FBaUJ2SSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5leHBvcnQgeyByZXNldFZhbGlkYXRpb24sIHRvZ2dsZUJ1dHRvblN0YXRlLCBkaXNhYmxlQnV0dG9uIH07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JNc2dFbC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBzZXR0aW5ncykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JNc2dFbC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgc2V0dGluZ3MpID0+IHtcbiAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBzZXR0aW5ncyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBzZXR0aW5ncyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4gIWlucHV0LnZhbGlkaXR5LnZhbGlkKTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGZvcm1FbCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWwucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3Ioc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBzZXR0aW5ncyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5jb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGlzdCwgc2V0dGluZ3MpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWwucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoZm9ybUVsLCBzZXR0aW5ncyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShmb3JtRWwsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChzZXR0aW5ncykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBzZXR0aW5ncyk7XG4gIH0pO1xufTtcbiIsImltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHNldHRpbmdzLCByZXNldFZhbGlkYXRpb24sIHRvZ2dsZUJ1dHRvblN0YXRlLCBkaXNhYmxlQnV0dG9uIH0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG4vLyBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkdvbGRlbiBHYXRlIEJyaWRnZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy83LXBob3RvLWJ5LWdyaWZmaW4td29vbGRyaWRnZS1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcblxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gXTtcblxuLy9FZGl0IFByb2ZpbGUgZWxlbWVudHNcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuXG4vL05ldyBwb3N0IGVsZW1lbnRzXG5jb25zdCBwcm9maWxlQWRkQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcblxuLy9Qcm9maWxlIGVsZW1lbnRzXG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG4vL01vZGFsIGVsZW1lbnRzXG5jb25zdCBhZGRDYXJkRm9ybUVsZW1lbnQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGNhcmRTdWJtaXRCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcbmNvbnN0IG5hbWVJbnB1dCA9IGFkZENhcmRGb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtY2FwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IGxpbmtJbnB1dCA9IGFkZENhcmRGb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5cbi8vUHJldmlldyBtb2RhbCBlbGVtZW50c1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdG4gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgcHJldmlld0ltYWdlRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbi8vRGVsZXRlIGZvcm0gZWxlbWVudHNcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIilcbmNvbnN0IHByZXZpZXdEZWxldGVNb2RhbCA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcblxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XG5cbi8vQXZhdGFyIGZvcm0gZWxlbWVudFxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyTW9kYWxDbG9zZUJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuXG4vLyBUZW1wbGF0ZSBhbmQgY2FyZHMgbGlzdCBlbGVtZW50c1xuLy8gVXNpbmcgcXVlcnlTZWxlY3RvciB0byBzZWxlY3QgdGhlIHRlbXBsYXRlIGFuZCBjYXJkcyBsaXN0XG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjVlZGU5YmZlLTk2MmYtNGVjNS05MWYyLWQ5MWYwYWQ4YmY5MlwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbdXNlciwgY2FyZHNdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgICByZXR1cm4gdXNlcjtcbiAgfSlcbiAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICBjb25zdCBhdmF0YXJJbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbiAgICBhdmF0YXJJbWcuc3JjID0gdXNlci5hdmF0YXI7XG5cbiAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcbiAgY29uc3QgY2FyZERlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcblxuICBjYXJkSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcbiAgY2FyZFRpdGxlRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG5cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9KTtcblxuY2FyZERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKTtcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG59KTtcblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcHJldmlld01vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9faXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGhhbmRsZU92ZXJsYXlDbGljayk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX19pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleSk7XG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbn1cblxuYXZhdGFyTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZUtleShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IGF2YXRhclVybCA9IGF2YXRhcklucHV0LnZhbHVlO1xuXG4gIGFwaVxuICAudXBkYXRlQXZhdGFyKHsgYXZhdGFyOiBhdmF0YXJVcmwgfSlcbiAgLnRoZW4gKChkYXRhKSA9PiB7XG4gICAgY29uc3QgYXZhdGFySW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG4gICAgYXZhdGFySW1nLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcbiAgICBjb25zb2xlLmxvZyhkYXRhLmF2YXRhcik7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlT3ZlcmxheUNsaWNrKGV2dCkge1xuICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9faXMtb3BlbmVkXCIpKSB7XG4gICAgY2xvc2VNb2RhbChldnQuY3VycmVudFRhcmdldCk7XG4gIH1cbn1cblxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybSxcbiAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoZWRpdFByb2ZpbGVGb3JtLCBzZXR0aW5ncyk7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5wcm9maWxlQWRkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oeyBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSwgYWJvdXQ6IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICAgIGNvbnNvbGUubG9nKFwic3VibWl0dGluZ1wiKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn0pO1xuXG5hZGRDYXJkRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBkaXNhYmxlQnV0dG9uKGNhcmRTdWJtaXRCdG4sIHNldHRpbmdzKTtcbiAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7XG4gICAgbmFtZTogbmFtZUlucHV0LnZhbHVlLFxuICAgIGxpbms6IGxpbmtJbnB1dC52YWx1ZSxcbiAgfTtcblxuICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGlucHV0VmFsdWVzKTtcbiAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICBhZGRDYXJkRm9ybUVsZW1lbnQucmVzZXQoKTtcbiAgcmVzZXRWYWxpZGF0aW9uKGFkZENhcmRGb3JtRWxlbWVudCwgW25hbWVJbnB1dCwgbGlua0lucHV0XSwgc2V0dGluZ3MpO1xuICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxucHJldmlld0RlbGV0ZU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiLy8gdXRpbHMvQXBpLmpzXG5cbmNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICB0aGlzLmdldFVzZXJJbmZvKClcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lLFxuICAgICAgYWJvdXQsXG4gICAgfSksXG4gIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH0pO1xufVxuXG5kZWxldGVDYXJkKGlkKSB7XG4gIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgfSk7XG59XG5cbnVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KSB7XG4gIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcbiAgfSkudGhlbigocmVzKSA9PlxuICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YClcbik7XG59XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwiZXJyb3JNc2dFbCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uRWwiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsImVkaXRQcm9maWxlQnRuIiwiZG9jdW1lbnQiLCJlZGl0UHJvZmlsZU1vZGFsIiwiZWRpdFByb2ZpbGVDbG9zZUJ0biIsImVkaXRQcm9maWxlRm9ybSIsImVkaXRQcm9maWxlTmFtZUlucHV0IiwiZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwicHJvZmlsZUFkZEJ0biIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ0biIsImF2YXRhck1vZGFsQnRuIiwicHJvZmlsZU5hbWVFbCIsInByb2ZpbGVEZXNjcmlwdGlvbkVsIiwiYWRkQ2FyZEZvcm1FbGVtZW50IiwiY2FyZFN1Ym1pdEJ0biIsIm5hbWVJbnB1dCIsImxpbmtJbnB1dCIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbENsb3NlQnRuIiwicHJldmlld0ltYWdlRWwiLCJwcmV2aWV3Q2FwdGlvbkVsIiwiZGVsZXRlTW9kYWwiLCJwcmV2aWV3RGVsZXRlTW9kYWwiLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjYXJkc0xpc3QiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiZ2V0VXNlckluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwibWV0aG9kIiwiZWRpdFVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWxldGVDYXJkIiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsInNyYyIsImxpbmsiLCJhbHQiLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlIiwiZXZ0IiwiaGFuZGxlRGVsZXRlQ2FyZCIsIm9wZW5Nb2RhbCIsImNsb3NlTW9kYWwiLCJtb2RhbCIsImhhbmRsZUVzY2FwZUtleSIsImhhbmRsZU92ZXJsYXlDbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJvcGVuZWRNb2RhbCIsInRhcmdldCIsImNvbnRhaW5zIiwiY3VycmVudFRhcmdldCIsInVzZXIiLCJjYXJkcyIsIml0ZW0iLCJwcmVwZW5kIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJwcmV2ZW50RGVmYXVsdCIsImF2YXRhclVybCIsInZhbHVlIiwicmVzZXQiLCJsb2ciLCJzZXRFdmVudExpc3RlbmVycyIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9